sudo: required

services:
        - docker

notifications:
        email: false

before_install:
        - echo host=localhost >> $HOME/.splunkrc
        - echo username=admin >> $HOME/.splunkrc
        - echo password=changeme >> $HOME/.splunkrc
        - export SPLUNK_HOME="/opt/splunk"
        - docker pull adamryman/splunk-travis-ci:$SPLUNK_VERSION
        -
        - until docker run -p 127.0.0.1:8089:8089 -d adamryman/splunk-travis-ci:$SPLUNK_VERSION; do echo "Retrying docker..."; done;
        - i="0"
        - while [ $i -lt 20 ];
          do
            if curl -sk https://localhost:8089/services/server/info 1>/dev/null $2>1;  then
                break;
            fi;
            echo yo;
            sleep 1;
            i=$[$i+1];
          done;

language: node_js
node_js:
        - "0.12"
        - "0.10"
        - "0.8"
        - "iojs"
env:
        - SPLUNK_VERSION=6.2.5
        - SPLUNK_VERSION=6.1.9
        - SPLUNK_VERSION=6.0.10

script:
        node sdkdo tests
